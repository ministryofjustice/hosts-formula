{%- set ip = grains['ip_interfaces']['eth0'][0] -%}
{%- set hosts = salt['pillar.get']('hosts', {}) -%}
{%- set local = hosts.pop(ip, None) -%}

127.0.0.1 localhost localhost.localdomain

{% if local %}
{{ ip }} {{ grains['fqdn'] }} {{ local | join(" ") }}
{% else %}
{{ ip }} {{ grains['fqdn'] }}
{% endif %}

{%- for ip, hostnames in hosts.iteritems() %}
{{ ip }}  {{ hostnames | join(" ") }}
{%- endfor %}

{%- set dynamic_hosts = salt['pillar.get']('dynamic_hosts', {}) -%}
{%- for comp_match, hostnames in dynamic_hosts.iteritems() %}
{% set host_ip = salt['publish.publish'](comp_match, 'network.ip_addrs', expr_form='compound').itervalues().next() %}
{{ host_ip[0] }} {{ hostnames | join(" ") }}
{%- endfor %}
